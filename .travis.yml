language: cpp
matrix:
  include:
    # works on Trusty
    - os: linux
      addons:
        apt:
          update: false
          sources:
            - llvm-toolchain-trusty-5.0
          packages:
            - build-essential
            - software-properties-common
            - clang-5.0
            - libc++-dev
            - libc++abi-dev
            - libdw-dev
      env:
        - CC_AND_CXX="CC=clang && CXX=clang++"
        - ALTERNATIVES_CC="/usr/bin/clang clang /usr/bin/clang-5.0"
        - ALTERNATIVES_CXX="/usr/bin/clang++ clang++ /usr/bin/clang++-libc++"
    # works on Precise and Trusty
    # - os: linux
    #   addons:
    #     apt:
    #       update: false
    #       sources:
    #         - ubuntu-toolchain-r-test
    #       packages:
    #         - build-essential
    #         - software-properties-common
    #         - g++-7
    #         - libstdc++-7-dev
    #         - libdw-dev
    #   env:
    #     - CC_AND_CXX="CC=gcc && CXX=g++"
    #     - ALTERNATIVES_CC="/usr/bin/gcc gcc /usr/bin/gcc-7"
    #     - ALTERNATIVES_CXX="/usr/bin/g++ g++ /usr/bin/g++-7"

before_install:
  - eval "${CC_AND_CXX}"

install:
  - eval "sudo update-alternatives --install ${ALTERNATIVES_CC} 90"
  - eval "sudo update-alternatives --install ${ALTERNATIVES_CXX} 90"

before_script:
  - clang++ --version
  - clang++-libc++ --version
  - mkdir build

script: cd build && cmake ../ -DCMAKE_BUILD_TYPE=RelWithDebInfo && make -j4

after_success: cd build && ./Tests

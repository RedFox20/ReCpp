language: python
python: "3.6"
sudo: required
matrix:
  include:
    - os: linux
      addons:
        apt:
          update: false
          sources:
            - llvm-toolchain-trusty-5.0
          packages:
            - libc++abi-dev
            - libc++-dev
            - lld-5.0
            - clang-5.0
            - libdw-dev
            - gdb
      env:
        - COMPILER=clang
    - os: linux
      addons:
        apt:
          update: false
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - build-essential
            - g++-7
            - libstdc++-7-dev
            - libdw-dev
            - gdb
      env:
        - COMPILER=gcc

install:
  - make configure-${COMPILER}-travis
  - pip install mama
  - alias mama=~/.local/bin/mama
  - ls -l /usr/local/clang-5.0.0/lib | grep libc++
  - ls -l /usr/lib/x86_64-linux-gnu | grep libc++
  - ls -l /usr/lib/llvm-5.0
  - ls -l /usr/lib/llvm-5.0/lib
  - ls -l /usr/lib/llvm-5.0/bin
  - ls -l /usr/bin | grep ll
  - readelf -Ws /usr/local/clang-5.0.0/lib/libc++.so.1.0 | grep shared_mutex
  - readelf -Ws /usr/lib/x86_64-linux-gnu/libc++.so.1.0 | grep shared_mutex

script:
  - export LD=/usr/bin/lld-link-5.0
  - mama build ${COMPILER} test
